# A testcase with manufactured solution that demonstrates that the mass
# formulation "hydrostatic pressure" is correct and converges. The example is
# constructed to have
#
# -\nabla \cdot \mathbf{u} = \left( \kappa \rho \textbf{g} - \alpha \nabla T \right) \cdot \textbf{u}
#
# using a specific gravity and a force vector is used to enforce the correct u
# and p (by canceling out the gravity term). This means the test will only
# work for this mass formulation.

set Nonlinear solver scheme                = no Advection, iterated Stokes
set Max nonlinear iterations               = 1
set Nonlinear solver tolerance             = 1e-10
set CFL number                             = 0.5
set Pressure normalization                 = no
set End time                               = 0
set Output directory                       = output-non-zero-eii
set Use years in output instead of seconds = false
set Dimension                              = 3


subsection Mesh refinement
  set Initial global refinement                = 4
  set Refinement fraction                      = 0.0
  set Coarsening fraction                      = 0.0
  set Time steps between mesh refinement       = 0
  set Initial adaptive refinement              = 0
end


subsection Boundary temperature model
  set List of model names = initial temperature

  subsection Initial temperature
    set Maximal temperature = 101.0
    set Minimal temperature = 99.0
  end

end

subsection Boundary composition model
  set List of model names = initial composition
end


subsection Geometry model
  set Model name = box # default:

  subsection Box
    set X extent  = 100e3
    set Y extent  = 100e3
    set Z extent  = 100e3
  end

end


subsection Mesh deformation
  set Mesh deformation boundary indicators        = top: free surface
  subsection Free surface
    set Surface velocity projection = vertical
  end
end


subsection Boundary velocity model
  subsection Function
    set Function constants = vel=0.1
    set Function expression = if ( (x==0), vel, if ( (x==100e3), -vel, 0) ) ; 0; 0
    set Variable names      = x,y,z
  end
end


subsection Initial temperature model
  set Model name = function # default:
  subsection Function
    set Function expression = 100.0
  end
end


subsection Material model
  set Model name = simple
  subsection Simple model
   set Viscosity = 1e21
  end 
end

subsection Gravity model
  set Model name = vertical
end

# The parameters below this comment were created by the update script
# as replacement for the old 'Model settings' subsection. They can be
# safely merged with any existing subsections with the same name.

subsection Boundary temperature model
  set Fixed temperature boundary indicators   = 0,1,2,3        # default:
end

subsection Boundary velocity model
  set Prescribed velocity boundary indicators = left:function, right:function
end


subsection Postprocess
  set List of postprocessors = visualization, velocity statistics, pressure statistics, velocity boundary statistics, boundary velocity residual statistics

  subsection Visualization
    set Interpolate output = false
    set List of output variables      =  strain rate, strain rate tensor, boundary strain rate residual
    set Time steps between graphical output = 0
  end

  subsection Boundary velocity residual statistics
    set Use ascii surface strain rate data = true
    set Data file name                     = box_3d_boundary_strain_rate.txt
    set Data directory                     = $ASPECT_SOURCE_DIR/data/postprocess/boundary-velocity-residual/
  end
end

