# This is a simple test for the equilibrium grain size material model. 
# Most parameters in the viscosity and grain growth laws are set to 1,
# except for the prefactor and strain-rate dependence of dislocation creep.
# The strain rate invariant is set to 1 (dux/dy=2, dux/dy=0, 
# so 1/2*dux/dy+1/2*duy/dx=1).
#
# If diffusion and dislocation creep take up this strain rate equally, 
# the strain rate accommodated by dislocation creep equals 0.5, 
# leading to a dislocation viscosity of 1. 

# For a grain size of 1, the diffusion viscosity is also 1. This leads
# to an overall viscosity of 0.5. 

# This does not change over time, as grain size is not allowed to evolve. 

set Additional shared libraries            = ../plugins/libequilibrium_grain_size.so

set Dimension                              = 2
set Use years in output instead of seconds = false
set Start time                             = 0
set End time                               = 1
set Nonlinear solver scheme                = iterated Advection and Stokes
set Max nonlinear iterations               = 50
set Nonlinear solver tolerance             = 1e-7

set Adiabatic surface temperature          = 1673
set Surface pressure                       = 5.e9

subsection Solver parameters
  subsection Stokes solver parameters
    set Linear solver tolerance = 1e-10
  end
end

subsection Compositional fields
  set Number of fields = 1
  set Names of fields = grain_size
  set Compositional field methods = prescribed field
end


subsection Initial composition model
  set List of model names = function

  subsection Function
    set Function expression = 1
  end
end


subsection Material model
  set Model name = equilibrium grain size

  subsection Equilibrium grain size model
    set Use equilibrium grain size                  = false
    set Average specific grain boundary energy      = 1.0

    set Diffusion activation energy                 = 0 #375000
    set Diffusion activation volume                 = 0 #6e-6
    set Diffusion creep exponent                    = 1.0
    set Diffusion creep grain size exponent         = 1 #3
    set Diffusion creep prefactor                   = 1 #1.25E-015

    set Dislocation activation energy               = 0 #530000
    set Dislocation activation volume               = 0 #1.40E-005
    set Dislocation creep exponent                  = 2 #3.5
    set Dislocation creep prefactor                 = 2 #8.33E-017

    set Geometric constant                          = 1 #3
    set Grain growth activation energy              = 0 #400000
    set Grain growth activation volume              = 0.0
    set Grain growth exponent                       = 1 #3
    set Grain growth rate constant                  = 1 #1.92e-10
    set Work fraction for boundary area change      = 1 #0.1

    set Maximum temperature dependence of viscosity = 1e6
    set Phase transition Clapeyron slopes           = 
    set Phase transition depths                     = 
    set Phase transition temperatures               = 
    set Phase transition widths                     = 
    set Reciprocal required strain                  = 1 #10
    set Recrystallized grain size                   = 

    set Reference compressibility                   = 4e-12
    set Reference density                           = 3400
    set Reference specific heat                     = 1250
    set Reference temperature                       = 1673
    set Thermal conductivity                        = 4
    set Thermal expansion coefficient               = 2e-5
    set Use paleowattmeter                          = true
    set Viscosity                                   = 1 #1e22

    set Minimum grain size                          = 1e-5
    set Minimum viscosity                           = 1e-5
    set Maximum viscosity                           = 1e3
  end
end


subsection Geometry model
  set Model name = box

  subsection Box
    set X extent  = 1
    set Y extent  = 1
    set X periodic = true
  end
end


subsection Boundary velocity model
  set Prescribed velocity boundary indicators = top:function, bottom:function

  subsection Function
    set Function expression = 2*y;0
  end
end

subsection Initial temperature model
  set List of model names = function

  subsection Function
    set Function expression = 1673
  end
end


subsection Gravity model
  set Model name = vertical

  subsection Vertical
    set Magnitude = 0
  end
end


subsection Mesh refinement
  set Initial global refinement          = 3
  set Initial adaptive refinement        = 0
  set Strategy                           = temperature
  set Time steps between mesh refinement = 0
end


subsection Postprocess
  set List of postprocessors = visualization, temperature statistics, velocity statistics, material statistics

  subsection Visualization
    set Output format                 = vtu
    set Time between graphical output = 0
    set List of output variables = material properties, strain rate, named additional outputs
  end
end

